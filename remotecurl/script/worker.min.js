function check_url(e){let t="";for(let r of $allow_url)!1!==r.test(e)&&(t=e);for(let r of $allow_url)!1!==r.test(e)&&(t="");return""!==t}function get_requested_url(e,t){if(void 0===e)return"";if(null===e)return null;if(e=e.toString(),"#"===e)return e;let r=[$base_main_url,$base_worker_url,$server_url,$main_path,$worker_path];for(let l of r)if(e.startsWith(l))try{let r=e.substring(l.length),u=new URL($url),n=new URL(r,u.origin);if(check_url(n.href))return t+n.href}catch(e){continue}let l=new URL(e,$url).href;return check_url(l)?t+l:e}function get_main_requested_url(e){return get_requested_url(e,$main_path)}function get_worker_requested_url(e){return get_requested_url(e,$worker_path)}function redirect_log(e,t,r){t!==r&&console.debug(e+": Redirect "+t+" to "+r)}if(!self._redirected){if(self._redirected=!0,self.XMLHttpRequest){let e=self.XMLHttpRequest.prototype.open;self.XMLHttpRequest.prototype.open=function(t,r,l=!0){let u=get_main_requested_url(r);redirect_log("XMLHttpRequest",r,u),e.call(this,t,u,l)}}let e=self.importScripts;self.importScripts=function(...t){let r=[];for(let e of t){let t=get_worker_requested_url(e);redirect_log("importScripts",e,t),r.push(t)}e.call(this,...r)};let t=self.fetch;self.fetch=function(e,r){let l=e;return"string"==typeof e?(l=get_main_requested_url(e),redirect_log("Fetch",e,l)):redirect_log("Fetch","<Request Object>","<new Request Object>"),t.call(this,l,r).then(function(e){return e})},self.Request=new Proxy(self.Request,{construct(e,t){let r=get_main_requested_url(t[0]);return redirect_log("Request",t[0],r),t[0]=r,new e(...t)}})}